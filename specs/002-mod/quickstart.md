# Quickstart: Crystalline Caves Biome World Generation Testing

**Feature**: Crystalline Cavesバイオームのワールド生成統合
**Date**: 2025-10-08
**Target Platform**: Fabric / NeoForge

## 概要

このドキュメントでは、Crystalline Cavesバイオームがワールド生成に正しく統合されているかを検証するための手動テスト手順を提供します。

---

## 前提条件

### 環境セットアップ
1. **Minecraft 1.21.1** がインストールされている
2. **Fabric Loader 0.17.2** または **NeoForge 21.1.74** がインストールされている
3. **WorldGenTest Mod** がビルドされ、`mods`フォルダに配置されている

### ビルド方法
```bash
cd /path/to/WorldGenTest
./gradlew build
```

ビルド成果物:
- Fabric: `fabric/build/libs/worldgentest-fabric-1.0.0.jar`
- NeoForge: `neoforge/build/libs/worldgentest-neoforge-1.0.0.jar`

---

## テストシナリオ

### シナリオ1: バイオームの基本生成確認（FR-001, FR-003）

**目的**: Crystalline Cavesバイオームが新規ワールドで生成されることを確認する。

#### 手順

1. **新規ワールド作成**
   - Minecraftを起動
   - 「シングルプレイ」→「ワールドを新規作成」
   - ワールド名: `test-crystalline-caves-001`
   - 「その他のワールド設定...」をクリック
   - ワールドタイプ: `Crystalline World`（カスタムワールドプリセット）
   - ゲームモード: `クリエイティブ`
   - チートを許可: `ON`
   - 「ワールドを生成」をクリック

2. **バイオーム検索**
   - ゲーム内でチャットを開く（デフォルト: `T`キー）
   - 以下のコマンドを実行:
     ```
     /locate biome worldgentest:crystalline_caves
     ```

3. **期待される結果**
   - ✅ コマンドがバイオームの座標を返す
     ```
     The nearest worldgentest:crystalline_caves is at [X, ~, Z] (約XXXブロック離れています)
     ```
   - ❌ 失敗例:
     ```
     Could not find that biome within reasonable distance
     ```

4. **バイオームへの移動**
   - 表示された座標にテレポート:
     ```
     /tp @s X ~ Z
     ```
   - Y座標を調整して地下に移動（例: Y=20）:
     ```
     /tp @s X 20 Z
     ```

5. **バイオーム特徴の確認**
   - F3デバッグ画面を開いて現在のバイオームを確認:
     ```
     Biome: worldgentest:crystalline_caves
     ```
   - 以下の特徴が存在することを確認:
     - ✅ クリスタルブロック（発光ブロック）
     - ✅ クリスタル鉱石（通常・深層岩バリアント）
     - ✅ クリスタル装飾（鍾乳石・光る苔）
     - ✅ 特有の水の色（青緑色）
     - ✅ 洞窟の雰囲気

**成功基準**:
- ✅ `/locate biome`でバイオームが見つかる
- ✅ バイオームの座標が妥当（1000～5000ブロック以内が目安）
- ✅ バイオーム内で既存のクリスタル関連ブロックが生成されている

---

### シナリオ2: 出現頻度の検証（FR-002）

**目的**: Crystalline Cavesバイオームが適切な頻度で出現することを確認する。

#### 手順

1. **複数のワールドで検証**
   - 3つの異なるシード値でワールドを作成（すべて`Crystalline World`タイプ）:
     - ワールド1: シード値 `12345`
     - ワールド2: シード値 `67890`
     - ワールド3: シード値 `11111`

2. **各ワールドでバイオーム検索**
   - 各ワールドで `/locate biome worldgentest:crystalline_caves` を実行
   - 現在地からの距離を記録

3. **期待される結果**
   - ✅ 3つのワールドすべてでバイオームが見つかる
   - ✅ 平均距離が1000～5000ブロック以内（中程度の頻度）
   - ⚠️ 距離が10000ブロック以上離れている場合は出現頻度が低すぎる可能性

**成功基準**:
- ✅ 3つのワールドすべてでバイオームが見つかる
- ✅ 平均距離が10000ブロック以内（発見可能な範囲）

---

### シナリオ3: 深度範囲の検証（FR-003）

**目的**: Crystalline Cavesが地表に出現せず、適切な深度（Y=38以下）で生成されることを確認する。

#### 手順

1. **バイオーム位置への移動**
   - シナリオ1で見つけたCrystalline Cavesの座標に移動

2. **Y座標の確認**
   - バイオームの上端（最も浅い部分）のY座標を確認
   - F3デバッグ画面で `Biome` が `worldgentest:crystalline_caves` になっている最も高いY座標を記録

3. **地表の確認**
   - 同じX,Z座標で地表（Y=64付近）まで移動
   - F3デバッグ画面でバイオームを確認

4. **期待される結果**
   - ✅ Crystalline Cavesの最高Y座標が約38以下
   - ✅ 地表（Y=64付近）ではCrystalline Cavesが表示されない
   - ✅ 地表のバイオームはバニラのもの（例: Plains、Forest等）

**成功基準**:
- ✅ バイオームが地下のみに存在（Y=38以下）
- ✅ 地表に漏出していない

---

### シナリオ4: 既存特徴の保持確認（FR-004）

**目的**: バイオーム内で既存のユニークな特徴が正常に生成されることを確認する。

#### 手順

1. **Crystalline Caves内を探索**
   - サバイバルモードに切り替え（`/gamemode survival`）
   - バイオーム内を10分程度探索

2. **以下の要素を確認**:

   | 要素 | 確認方法 | 期待される結果 |
   |------|---------|--------------|
   | **クリスタルブロック** | 発光ブロックを探す | ✅ 洞窟壁・天井に配置 |
   | **クリスタル鉱石** | 通常の石・深層岩内 | ✅ ダイヤのツルハシで採掘可能 |
   | **クリスタル装飾** | 鍾乳石・光る苔 | ✅ 洞窟の装飾として配置 |
   | **水の色** | 水たまりを探す | ✅ 青緑色の水 |
   | **Mobスポーン** | 敵対Mobの出現 | ✅ Zombie、Skeleton、Creeper等 |
   | **Crystal Golem** | 友好的なカスタムMob | ✅ 稀にスポーン |
   | **廃坑** | 構造物の生成 | ✅ バイオーム内で発見可能 |

3. **クリスタルブロックの確認**
   - クリスタルブロックを破壊して入手
   - インベントリで `worldgentest:crystal_block` であることを確認

4. **Mob確認**
   - 難易度を「ノーマル」以上に設定
   - バイオーム内で5分待機
   - 敵対Mobがスポーンすることを確認

**成功基準**:
- ✅ すべてのクリスタル関連ブロックが生成されている
- ✅ Mobスポーンが正常に機能
- ✅ バイオームの視覚的特徴（水の色、霧等）が保たれている

---

### シナリオ5: マルチプレイヤー環境での動作確認（FR-005）

**目的**: シングルプレイヤーとマルチプレイヤー両方の環境で正常に動作することを確認する。

#### 手順（サーバー環境）

1. **サーバーのセットアップ**
   - Fabric ServerまたはNeoForge Serverをインストール
   - WorldGenTest Modをサーバーの`mods`フォルダに配置
   - サーバーを起動

2. **サーバーでの検証**
   - サーバーコンソールまたはOPプレイヤーとしてログイン
   - `/locate biome worldgentest:crystalline_caves` を実行

3. **複数プレイヤーでの確認**
   - 2人のプレイヤーがログイン
   - プレイヤー1: バイオームの座標Aに移動
   - プレイヤー2: 同じ座標Aに移動
   - 両プレイヤーが同じバイオームを見ていることを確認

4. **期待される結果**
   - ✅ サーバーでもバイオームが生成される
   - ✅ 複数プレイヤーが同じバイオームを体験できる
   - ✅ サーバーパフォーマンスに大きな影響がない

**成功基準**:
- ✅ サーバー環境でバイオームが正常に生成
- ✅ 複数プレイヤー間でバイオームの一貫性がある

---

### シナリオ6: シード値再現性の検証（FR-007）

**目的**: 同じシード値で同じバイオーム配置が再現されることを確認する。

#### 手順

1. **ワールド1の作成**
   - シード値: `999999`
   - `/locate biome worldgentest:crystalline_caves` を実行
   - 座標を記録（例: `[1234, ~, 5678]`）

2. **ワールド2の作成**
   - 同じシード値: `999999`
   - `/locate biome worldgentest:crystalline_caves` を実行
   - 座標を記録

3. **座標の比較**
   - ワールド1とワールド2の座標が一致することを確認

4. **期待される結果**
   - ✅ 同じシード値で同じ座標にCrystalline Cavesが生成される
   - ✅ バイオーム内の地形・ブロック配置も一致

**成功基準**:
- ✅ 同じシード値で同じバイオーム配置が再現される

---

### シナリオ7: パフォーマンスの確認（FR-008）

**目的**: Crystalline Cavesの生成がバニラ洞窟バイオームと同等のパフォーマンスを保つことを確認する。

#### 手順

1. **チャンク生成時のパフォーマンス測定**
   - F3デバッグ画面を開く
   - Crystalline Caves内を飛行しながら新しいチャンクを生成
   - F3画面の右側のグラフでFPSを確認

2. **比較対象: バニラ洞窟バイオーム**
   - Lush Caves内を同様に飛行
   - FPSを確認

3. **ワールド作成時間の比較**
   - Crystalline Caves統合前のビルドでワールドを作成
   - ワールド作成画面の「ワールドを生成中...」の時間を測定
   - Crystalline Caves統合後のビルドで同じシード値のワールドを作成
   - 時間を比較

4. **期待される結果**
   - ✅ Crystalline Caves内でのFPSがLush Cavesと同程度
   - ✅ ワールド作成時間に大きな差がない（±10%以内）
   - ✅ メモリ使用量に異常な増加がない

**成功基準**:
- ✅ FPSがバニラ洞窟バイオームと同程度
- ✅ ワールド作成時間の増加が10%以内

---

### シナリオ8: ワールドタイプ選択の確認（FR-001）

**目的**: カスタムワールドプリセット「Crystalline World」が正しく選択可能で、意図通りに動作することを確認する。

#### 手順

1. **ワールド作成画面の確認**
   - Minecraftを起動
   - 「シングルプレイ」→「ワールドを新規作成」
   - 「その他のワールド設定...」をクリック
   - 「ワールドタイプ」ボタンを複数回クリックして選択肢を確認

2. **期待される選択肢**
   - ✅ `デフォルト`（バニラ）
   - ✅ `スーパーフラット`（バニラ）
   - ✅ `ラージバイオーム`（バニラ）
   - ✅ `アンプリファイド`（バニラ）
   - ✅ `シングルバイオーム`（バニラ）
   - ✅ **`Crystalline World`（カスタム）** ← これが表示されるか確認

3. **カスタムワールドタイプの名前確認**
   - ワールドタイプを`Crystalline World`に設定
   - 表示されている名前が正しいことを確認（英語: "Crystalline World"、日本語: "クリスタルの世界"）

4. **ワールド生成の確認**
   - `Crystalline World`タイプでワールドを作成
   - ワールドが正常に生成されることを確認
   - `/locate biome worldgentest:crystalline_caves` でバイオームが見つかることを確認

**成功基準**:
- ✅ ワールドタイプ選択肢に`Crystalline World`が表示される
- ✅ 言語設定に応じて正しい名前が表示される
- ✅ ワールドが正常に生成される

---

## トラブルシューティング

### 問題1: `/locate biome`でバイオームが見つからない

**症状**: `Could not find that biome within reasonable distance`

**原因と解決策**:

1. **Multi-noise parametersファイルが正しく配置されていない**
   - 確認: `common/src/main/resources/data/worldgentest/worldgen/multi_noise_biome_source_parameter_list/overworld_caves.json` が存在するか
   - 解決: ファイルを作成し、再ビルド

2. **Biome Tagsが正しく設定されていない**
   - 確認: `data/minecraft/tags/worldgen/biome/is_overworld.json` に `worldgentest:crystalline_caves` が含まれているか
   - 解決: タグファイルを作成し、再ビルド

3. **Parameter範囲が狭すぎる**
   - 原因: `depth`や`temperature`の範囲が狭すぎて出現頻度が極端に低い
   - 解決: `offset`を`0.5`に設定してテスト用に出現頻度を上げる

### 問題2: 地表にCrystalline Cavesが出現してしまう

**症状**: Y=64付近でCrystalline Cavesバイオームが表示される

**原因と解決策**:

1. **Depthパラメータの最小値が低すぎる**
   - 確認: `overworld_caves.json`の`depth`が`[0.0, 1.0]`になっていないか
   - 解決: `depth: [0.2, 1.0]`に変更（最小値を0.2に）

### 問題3: パフォーマンスが低下する

**症状**: Crystalline Caves内でFPSが大幅に低下

**原因と解決策**:

1. **Feature配置が過剰**
   - 確認: `crystalline_caves.json`の`features`配列に不要なFeatureが含まれていないか
   - 解決: 重いFeature（大規模構造物等）を削除

2. **Mobスポーン設定が過剰**
   - 確認: `spawners`設定のweight値が高すぎないか
   - 解決: weight値をバニラバイオームと同程度に調整

---

## 成功チェックリスト

すべての機能要件が満たされているか確認：

- [ ] **FR-001**: 新規ワールドでCrystalline Cavesが自然に生成される
- [ ] **FR-002**: 出現頻度がバニラ洞窟バイオームと同程度
- [ ] **FR-003**: サバイバルモードの通常探索で発見できる（地表に出現しない）
- [ ] **FR-004**: 既存のクリスタルブロック、鉱石、装飾、Mobが保たれている
- [ ] **FR-005**: シングル/マルチプレイヤー両方で動作する
- [ ] **FR-006**: バニラのワールドタイプ（デフォルト）と互換性がある
- [ ] **FR-007**: 同じシード値で同じバイオーム配置が再現される
- [ ] **FR-008**: パフォーマンスがバニラ洞窟バイオームと同程度

---

## 追加テストケース（オプション）

### エッジケース1: 海洋バイオームとの境界

**手順**:
- 海洋バイオーム（Ocean、Deep Ocean）の座標でY=-20に移動
- Crystalline Cavesが生成されるか確認

**期待される結果**:
- ⚠️ Continentalness設定により、海洋では出現しない（または非常に稀）

### エッジケース2: 極端な高度

**手順**:
- Y=200（山頂）、Y=-60（基盤岩付近）でCrystalline Cavesを探す

**期待される結果**:
- ✅ Y=200では出現しない（Depthパラメータによる制限）
- ✅ Y=-60では出現する（Depth範囲内）

### エッジケース3: 他のModとの互換性

**手順**:
- 他のバイオームModを追加してワールドを生成
- Crystalline Cavesが正常に生成されるか確認

**期待される結果**:
- ✅ 他のModバイオームと競合せず共存する

---

## 報告テンプレート

テスト結果を以下の形式で報告：

```
### テスト報告

**テスト日時**: 2025-10-XX
**プラットフォーム**: Fabric / NeoForge
**Minecraftバージョン**: 1.21.1
**Modバージョン**: 1.0.0

#### シナリオ1: バイオームの基本生成確認
- [ ] 合格 / [ ] 不合格
- 備考: _____

#### シナリオ2: 出現頻度の検証
- [ ] 合格 / [ ] 不合格
- 平均距離: _____ ブロック
- 備考: _____

（以下省略）

#### 全体評価
- [ ] すべてのシナリオ合格
- [ ] 一部不合格（詳細は上記参照）
```

---

## 次のステップ

1. ✅ Quickstart作成完了
2. ⏳ CLAUDE.md更新
3. ⏳ Phase 2: Task Planning Approach記述
